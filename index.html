<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã²ã‚ã•ã‚“ã®é£Ÿäº‹ç®¡ç†AI</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #f0f8ff; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); max-width: 400px; margin: auto; }
        img { max-width: 100%; border-radius: 10px; margin-top: 10px; display: none; }
        #result { text-align: left; margin-top: 20px; white-space: pre-wrap; font-size: 14px; }
        button { background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 25px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .settings { margin-top: 30px; font-size: 12px; color: #888; border-top: 1px solid #ddd; padding-top: 10px; }
        input { padding: 8px; width: 80%; border: 1px solid #ccc; border-radius: 5px; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ´ ã²ã‚ã•ã‚“ã®é£Ÿäº‹è§£æ</h2>
    <input type="file" id="imageInput" accept="image/*" style="display:none;">
    <button onclick="document.getElementById('imageInput').click()">ğŸ“· å†™çœŸã‚’æ’®ã‚‹ãƒ»é¸ã¶</button>
    <img id="preview">
    <div id="result"></div>
</div>

<div class="settings">
    <p>âš™ï¸ è¨­å®š: APIã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆåˆå›ã®ã¿ï¼‰</p>
    <input type="password" id="apiKeyInput" placeholder="AIza...">
    <button onclick="saveKey()" style="padding: 5px 10px; font-size: 12px; background: #6c757d;">ã‚­ãƒ¼ã‚’ä¿å­˜</button>
</div>

<script>
    // ã‚¹ãƒãƒ›ã®ä¿å­˜é ˜åŸŸã‹ã‚‰ã‚­ãƒ¼ã‚’èª­ã¿è¾¼ã‚€
    let apiKey = localStorage.getItem('GEMINI_API_KEY') || '';
    if (apiKey) document.getElementById('apiKeyInput').value = apiKey;

    function saveKey() {
        const key = document.getElementById('apiKeyInput').value;
        localStorage.setItem('GEMINI_API_KEY', key);
        alert('ã‚­ãƒ¼ã‚’ã‚¹ãƒãƒ›ã«ä¿å­˜ã—ã¾ã—ãŸï¼');
        location.reload();
    }

    const imageInput = document.getElementById('imageInput');
    const preview = document.getElementById('preview');
    const resultDiv = document.getElementById('result');

    imageInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = async (re) => {
            preview.src = re.target.result;
            preview.style.display = 'block';
            resultDiv.innerText = 'è§£æä¸­... ã²ã‚ã•ã‚“ã€å°‘ã€…ãŠå¾…ã¡ã‚’ï¼';
            
            const base64Image = re.target.result.split(',')[1];
            await analyzeImage(base64Image);
        };
        reader.readAsDataURL(file);
    });

    async function analyzeImage(base64Image) {
        const currentKey = localStorage.getItem('GEMINI_API_KEY');
        if (!currentKey) {
            resultDiv.innerText = 'âš ï¸ ä¸‹ã®è¨­å®šæ¬„ã«APIã‚­ãƒ¼ã‚’å…¥ã‚Œã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚';
            return;
        }

        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${currentKey}`;
        
        const data = {
            contents: [{
                parts: [
                    { text: "ã‚ãªãŸã¯ãƒ—ãƒ­ã®ç®¡ç†æ „é¤Šå£«ã§ã™ã€‚ç§ã®åå‰ã¯ã€Œã²ã‚ã•ã‚“ã€ã§ã™ã€‚ã“ã®é£Ÿäº‹ã‚’è§£æã—ã€ãƒã‚¸ãƒ†ã‚£ãƒ–ãªæ„Ÿæƒ³ã€æ¦‚ç®—ã‚«ãƒ­ãƒªãƒ¼ã€å¥åº·ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã€100ç‚¹æº€ç‚¹ã®è©•ä¾¡ã‚’è¦ªã—ã¿ã‚„ã™ãå›ç­”ã—ã¦ãã ã•ã„ã€‚" },
                    { inline_data: { mime_type: "image/jpeg", data: base64Image } }
                ]
            }]
        };

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            if (result.candidates) {
                resultDiv.innerText = result.candidates[0].content.parts[0].text;
            } else {
                resultDiv.innerText = 'ã‚¨ãƒ©ãƒ¼: ' + JSON.stringify(result);
            }
        } catch (error) {
            resultDiv.innerText = 'é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
        }
    }
</script>

</body>
</html>
